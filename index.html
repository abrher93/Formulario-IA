<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Enviar operación — Webhook n8n</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#7c3aed;--muted:#9aa4b2;--success:#16a34a}
    *{box-sizing:border-box}
    body{font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:linear-gradient(180deg,#071029 0%, #0b1220 100%); color:#e6eef6; margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px}
    .card{width:100%; max-width:760px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px; padding:20px; box-shadow:0 6px 24px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03)}
    h1{margin:0 0 6px;font-size:20px}
    p.lead{margin:0 0 18px;color:var(--muted)}
    form{display:grid; gap:12px}
    label{font-size:13px;color:var(--muted)}
    input[type="text"], textarea{width:100%; padding:12px 14px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:inherit; font-size:15px}
    textarea{min-height:80px; resize:vertical}
    .row{display:flex; gap:10px}
    .btn{display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:8px; background:var(--accent); color:white; border:none; cursor:pointer; font-weight:600}
    .btn[disabled]{opacity:.6; cursor:not-allowed}
    .muted{color:var(--muted); font-size:13px}
    .result{margin-top:14px; padding:12px; border-radius:8px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03)}
    .success{color:var(--success); font-weight:700}
    .error{color:#ff6b6b; font-weight:700}
    footer{margin-top:14px; font-size:12px; color:var(--muted)}
    .small{font-size:13px}
  </style>
</head>
<body>
  <main class="card">
    <h1>Enviar operación al Webhook</h1>
    <p class="lead">Introduce una expresión aritmética y envíala al webhook de n8n. Se enviará un JSON con el campo <code>operacion</code>.</p>

    <form id="opForm">
      <div>
        <label for="operacion">Expresión aritmética</label>
        <input id="operacion" name="operacion" type="text" placeholder="Ej: (10/2) + 4 * 3" autocomplete="off" required />
      </div>

      <div class="row">
        <button id="submitBtn" class="btn" type="submit">Enviar</button>
        <button id="exampleBtn" class="btn" type="button" style="background:#334155">Ejemplo</button>
        <div style="flex:1"></div>
        <div class="muted small">Webhook: <strong>https://tk94.app.n8n.cloud/webhook/operacion</strong></div>
      </div>

      <div id="status" class="result" style="display:none"></div>
    </form>

    <footer>
      <div class="small">Nota: el webhook debe aceptar peticiones CORS desde este origen. Si recibes errores de CORS, prueba con una llamada desde tu backend o usa una herramienta como curl/postman.</div>
    </footer>
  </main>

  <script>
    (function(){
      const form = document.getElementById('opForm');
      const operInput = document.getElementById('operacion');
      const submitBtn = document.getElementById('submitBtn');
      const exampleBtn = document.getElementById('exampleBtn');
      const statusBox = document.getElementById('status');

      const WEBHOOK_URL = 'https://tk94.app.n8n.cloud/webhook/operacion';

      exampleBtn.addEventListener('click', () => {
        operInput.value = '(10/2) + 4 * 3';
        operInput.focus();
      });

      function showStatus(html, type){
        statusBox.style.display = 'block';
        statusBox.innerHTML = html;
        statusBox.className = 'result ' + (type === 'ok' ? 'success' : 'error');
      }

      form.addEventListener('submit', async (ev) => {
        ev.preventDefault();
        const oper = operInput.value.trim();
        if(!oper){
          showStatus('Escribe una operación válida antes de enviar.', 'error');
          return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Enviando...';
        showStatus('Enviando petición...', '');

        try{
          const payload = { operacion: oper };

          const resp = await fetch(WEBHOOK_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
          });

          const text = await resp.text();

          if(resp.ok){
            showStatus('<strong>Enviado correctamente.</strong><br/><pre style="white-space:pre-wrap;margin:8px 0;">' + escapeHtml(text) + '</pre>', 'ok');
          } else {
            showStatus('<strong>Error del servidor:</strong> ' + resp.status + ' ' + resp.statusText + '<br/><pre style="white-space:pre-wrap;margin:8px 0;">' + escapeHtml(text) + '</pre>', 'error');
          }
        } catch (err){
          showStatus('<strong>Error de conexión:</strong> ' + err.message, 'error');
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = 'Enviar';
        }
      });

      function escapeHtml(str){
        return String(str)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/\"/g, '&quot;')
          .replace(/\'/g, '&#39;');
      }
    })();
  </script>
</body>
</html>
